{% extends 'base.html' %}
{% block title %}iFome - Restaurante{% endblock %}
{% block messages %}{% endblock %}  <!-- remove mensagens flashes nesta página -->
{% block content %}
    <div class="max-w-7xl mx-auto bg-white p-6 rounded-2xl shadow-lg">
        <div class="flex items-center gap-6">
            <img src="{{ url_for('static', filename=restaurante.imagem_restaurante.split('static/')[1]) }}" alt="Imagem do Restaurante" class="w-32 h-32 object-cover rounded-full mb-4">
            <h1 id="nome" class="text-3xl font-bold text-gray-800">Carregando...</h1>
            <span class="text-yellow-99-dark">★ 4.8</span>
        </div>

        <div class="mt-4">
            <label><b>Telefone</b></label>
            <p id="telefone" class="text-gray-600 mb-4"></p>
            <label><b>Endereço</b></label>
            <p id="endereco" class="text-gray-600 mb-4"></p>
            <label><b>Horário de funcionamento</b></label>
            <p id="hora_funcionamento" class="text-gray-600 mb-4"></p>
        </div>
    </div>

    <div id="container" class="max-w-7xl mx-auto mt-8 bg-white p-6 rounded-2xl shadow-lg">
        <h2 class="text-2xl font-bold text-gray-800 mb-4">Cardápio</h2>
        {% for c in cardapio %}
        <!-- se tiver o status do cardápio estiver ativo... -->
            {% if c.ativo != false %}
                 <section class="mb-6">
                    <h3 class="text-xl font-semibold mb-3">{{ c.nome_cardapio }}</h3>

                    <div class="mt-3 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                      {% for p in c.produtos %}
                        {% if p.disponivel != false %}
                          <div class="bg-white border rounded-lg overflow-hidden shadow-sm" style="aspect-ratio:1/1;">
                            <div class="p-4 h-full flex flex-col justify-between">
                              <div>
                                <div class="font-medium text-lg text-gray-800 truncate">{{ p.nome_item }}</div>
                                <div class="text-sm text-gray-500 mt-2 line-clamp-3">{{ p.descricao }}</div>
                              </div>
                              <div class="mt-3 text-right">
                                <span class="text-green-600 font-semibold text-lg">R$ {{ '%.2f'|format(p.preco) }}</span>
                              </div>
                            </div>
                          </div>
                        {% endif %}
                      {% endfor %}
                    </div>
                </section>
            {% endif %}
        {% endfor %}
    </div>
{% endblock content %}

{% block scripts %}
    <script>
        const restauranteId = "{{ restaurante_id }}";

        // faz uma requisição assíncrona para buscar dados da API
        fetch(`/api/restaurantes/${restauranteId}`)
            .then(res => res.json())
            .then(data => {
                if (data.erro) {
                    document.getElementById('container').innerHTML = `<p class="text-red-500">${data.erro}</p>`;
                    return;
                }

                document.getElementById('nome').textContent = data.nome;
                document.getElementById('hora_funcionamento').textContent = `${data.hora_abertura} - ${data.hora_fechamento}`;
                document.getElementById('telefone').textContent = data.telefone;
                document.getElementById('endereco').textContent = `${data.endereco.rua}, ${data.endereco.numero} - ${data.endereco.bairro} - ${data.endereco.cidade}, ${data.endereco.estado}, ${data.endereco.cep}`;

                // const ul = document.getElementById('cardapio');
                // data.cardapio.forEach(item => {
                //     const li = document.createElement('li');
                //     li.className = "flex justify-between border-b pb-2";
                //     li.innerHTML = `<span>${item.nome}</span><span class="text-gray-700 font-medium">R$ ${item.preco}</span>`;
                //     ul.appendChild(li);
                // });
            })
            .catch(err => {
                document.getElementById('container').innerHTML = `<p class="text-red-500">Erro ao carregar restaurante.</p>`;
            });
    </script>
{% endblock %}